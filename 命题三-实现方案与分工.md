# 命题三：跨学科知识图谱智能体 - 实现方案与分工

## 一、项目概述

### 1.1 项目名称
**ConceptGraph AI** - 跨学科知识图谱智能体

### 1.2 痛点与目标
- **痛点**：知识碎片化严重，难以发现不同学科间的内在关联
- **目标**：利用智能体自动挖掘跨领域概念桥梁，构建可视化知识图谱
- **价值**：帮助学习者建立知识网络，理解"神经网络"与"生物学""数学"的深层联系

### 1.3 核心功能
- ✅ **关联挖掘**：在6个学科领域（数学、物理、化学、生物、计算机、社会学）自动发现概念关联
- ✅ **知识校验**：多源验证机制，避免大模型幻觉
- ✅ **图谱构建**：提取实体和关系，生成标准JSON格式
- ✅ **动态可视化**：Web端交互式图谱展示，支持节点展开、学科筛选

---

## 二、系统架构设计

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    前端层 (Frontend Layer)                     │
│         React + D3.js/Echarts + WebSocket                     │
│         - 图谱可视化  - 交互控制  - 实时更新                   │
└─────────────────────────────────────────────────────────────┘
                            ↓ HTTPS/WSS
┌─────────────────────────────────────────────────────────────┐
│                  API Gateway (Nginx/Traefik)                  │
│              统一入口、负载均衡、路由分发                        │
└─────────────────────────────────────────────────────────────┘
                            ↓
        ┌───────────────────┼───────────────────┐
        ↓                   ↓                   ↓
┌──────────────┐  ┌──────────────────┐  ┌──────────────┐
│ 概念查询服务  │  │  知识图谱服务     │  │  可视化服务   │
│ (FastAPI)    │  │  (FastAPI)       │  │  (Node.js)   │
│ - 概念搜索    │  │  - 图谱CRUD      │  │  - 图渲染    │
│ - 学科分类    │  │  - 关系查询      │  │  - 数据转换  │
└──────────────┘  └──────────────────┘  └──────────────┘
        ↓                   ↓                   ↓
┌──────────────────────────────────────────────────────────┐
│              智能体编排层 (Agent Orchestration Layer)       │
│  ┌────────────┐  ┌────────────┐  ┌──────────────┐       │
│  │ 关联挖掘    │→ │ 知识校验    │→ │ 图谱构建      │       │
│  │ Agent      │  │ Agent      │  │ Agent        │       │
│  │ (发现概念)  │  │ (验证可靠性)│  │ (生成JSON)   │       │
│  └────────────┘  └────────────┘  └──────────────┘       │
└──────────────────────────────────────────────────────────┘
        ↓                   ↓                   ↓
┌───────────┐  ┌────────────────┐  ┌──────────────────┐
│  LLM服务   │  │  向量数据库     │  │   图数据库       │
│ (OpenAI/   │  │  (Milvus/      │  │   (Neo4j)        │
│  Claude)   │  │   Pinecone)    │  │  - 存储节点/边    │
│ - GPT-4    │  │  - 语义检索     │  │  - Cypher查询    │
└───────────┘  └────────────────┘  └──────────────────┘
        ↓                   ↓                   ↓
┌──────────────────────────────────────────────────────────┐
│            基础设施层 (Infrastructure Layer)                │
│  Docker + Kubernetes + Redis(缓存) + MinIO(对象存储)       │
│  Prometheus(监控) + Grafana(可视化)                        │
└──────────────────────────────────────────────────────────┘
```

### 2.2 数据流向

```
用户输入概念 "熵"
    ↓
API Gateway → 概念查询服务
    ↓
关联挖掘Agent
  ├─ 调用LLM (GPT-4)
  ├─ CoT推理：在6个学科搜索相关概念
  ├─ 输出：24个候选概念及关联逻辑
    ↓
知识校验Agent ⭐ (解决大模型幻觉)
  ├─ Wikipedia API验证
  ├─ 学术数据库交叉检查
  ├─ 可信度评分 (0-1)
  ├─ 输出：18个验证通过的概念
    ↓
图谱构建Agent
  ├─ 实体提取 (概念名、学科、定义)
  ├─ 关系量化 (关联强度 0-1)
  ├─ 生成JSON (nodes + edges)
    ↓
存储到Neo4j图数据库
    ↓
WebSocket实时推送到前端
    ↓
D3.js渲染交互式图谱
```

### 2.3 核心组件说明

#### 2.3.1 智能体编排层（Agent Layer）

采用**多Agent协作**模式，确保知识质量：

**1. 关联挖掘Agent (Concept Discovery Agent)**
- **输入**：核心概念词（如"熵"）
- **任务**：在多个学科领域搜索相关概念
- **策略**：
  - CoT推理：明确推理步骤
  - 学科强制覆盖：数学、物理、化学、生物、计算机、社会学
  - 关联强度评分：基于底层原理的相似性
- **工具链**：Wikipedia API, Arxiv API, 学科关键词库
- **输出示例**：
  ```json
  {
    "discipline": "信息论",
    "related_concepts": ["香农熵", "信息增益"],
    "reasoning": "都描述系统的不确定性",
    "strength": 0.92
  }
  ```

**2. 知识校验Agent (Verification Agent)** ⭐ **关键创新点**
- **输入**：挖掘出的概念关联
- **任务**：验证关联的合理性和事实准确性
- **策略**：
  - 多源交叉验证（Wikipedia + 学术数据库）
  - 可信度评分算法（基于证据数量和来源权威性）
  - 低于阈值（0.5）标记为"待验证"
- **输出**：
  ```json
  {
    "credibility_score": 0.87,
    "evidence": ["Wikipedia: ...", "Arxiv论文: ..."],
    "warning": null
  }
  ```

**3. 图谱构建Agent (Graph Builder Agent)**
- **输入**：已验证的概念关联
- **任务**：提取实体、关系，生成标准图结构
- **输出**：JSON格式（nodes + edges）
  ```json
  {
    "nodes": [
      {
        "id": "entropy_info",
        "label": "熵",
        "discipline": "信息论",
        "definition": "信息的不确定性度量",
        "credibility": 0.95
      }
    ],
    "edges": [
      {
        "source": "entropy_info",
        "target": "shannon_entropy",
        "relation": "is_foundation_of",
        "weight": 0.92
      }
    ]
  }
  ```

#### 2.3.2 数据存储层

- **Neo4j图数据库**：存储知识图谱（节点、边、属性）
- **Milvus向量数据库**：存储概念向量，实现语义相似度检索
- **Redis缓存**：缓存热点查询结果，减少LLM重复调用
- **MinIO对象存储**：存储图谱历史版本快照

#### 2.3.3 前端可视化

- **D3.js力导向图**：动态渲染知识网络
- **交互功能**：
  - 节点点击：展开相关子概念（增量挖掘）
  - 边权重可视化：线条粗细表示关联强度
  - 学科分类着色：不同颜色代表不同学科
  - 可信度标记：低可信度节点半透明显示

---

## 三、技术栈

### 云原生组件（评分占比30%）
- ✅ **Docker**：所有服务容器化
- ✅ **Kubernetes**：服务编排、自动扩缩容（HPA）
- ✅ **Redis**：分布式缓存
- ✅ **MinIO**：对象存储（兼容S3）
- ✅ **Prometheus + Grafana**：监控和告警
- ✅ **Nginx/Traefik**：API Gateway

### 智能体技术
- **LangChain / AutoGen**：Agent框架
- **OpenAI GPT-4 / Claude**：大语言模型
- **Sentence-Transformers**：概念向量化

### 后端技术
- **FastAPI**：高性能异步框架
- **Neo4j + Cypher**：图数据库查询
- **Milvus**：向量数据库
- **WebSocket**：实时通信

### 前端技术
- **React 18**：前端框架
- **D3.js / Echarts**：图谱可视化
- **TypeScript**：类型安全
- **Ant Design**：UI组件库

---

## 四、两人分工方案（各50%，可并行开发）

### 设计原则
- ✅ **模块独立**：各自负责独立模块，避免强依赖
- ✅ **接口先行**：第3天定义清晰的API接口（JSON Schema）
- ✅ **并行开发**：双方可同时开发，最后集成
- ✅ **均衡工作量**：技术难度和工作时间均衡

---

### 成员A：智能体与算法组（50%贡献）

#### 核心职责
**智能体设计 + LLM集成 + 知识挖掘算法**

#### 详细任务清单

| 序号 | 模块 | 具体内容 | 贡献占比 | 预计工时 |
|------|------|---------|---------|---------|
| 1 | **智能体编排系统** | - 设计3个Agent的协作流程<br>- 实现Agent编排器（orchestrator.py）<br>- 编写Prompt模板库<br>- 实现CoT推理链<br>- LLM API调用封装和错误重试 | 20% | 16h |
| 2 | **关联挖掘算法** | - 跨学科概念搜索策略<br>- 学科领域分类器<br>- 语义相似度计算（向量嵌入）<br>- Wikipedia/Arxiv数据抓取<br>- "远亲概念"发现算法 | 15% | 12h |
| 3 | **知识校验层** ⭐ | - 多源验证逻辑<br>- 可信度评分算法<br>- 冲突检测和仲裁<br>- 来源溯源模块 | 10% | 8h |
| 4 | **数据处理** | - 概念实体提取<br>- 关系强度量化<br>- JSON Schema定义<br>- 数据清洗和标准化 | 5% | 4h |

**合计：50%  |  总工时：40小时**

#### 交付物清单

```
agents/                              # Agent核心代码
├── __init__.py
├── config.yaml                      # Agent配置
├── orchestrator.py                  # Agent编排器（主入口）
├── concept_discovery_agent.py       # 关联挖掘Agent
├── verification_agent.py            # 知识校验Agent
├── graph_builder_agent.py           # 图谱构建Agent
├── utils.py                         # 工具函数
└── requirements.txt

prompts/                             # Prompt模板库
├── __init__.py
├── prompt_config.json
├── discovery_prompts.py             # 挖掘Prompt（带CoT）
├── verification_prompts.py          # 校验Prompt
└── graph_prompts.py                 # 图谱生成Prompt

algorithms/                          # 算法实现
├── __init__.py
├── semantic_similarity.py           # 语义相似度
├── discipline_classifier.py         # 学科分类
├── credibility_scorer.py            # 可信度评分
└── data_crawler.py                  # 数据抓取

tests/
└── test_agents.py                   # Agent单元测试

docs/
├── agent-design.md                  # Agent设计文档
├── prompt-templates.md              # Prompt模板说明
└── api-agent.md                     # Agent API接口文档
```

#### 关键接口（提供给成员B）

**接口1：概念挖掘**
```python
POST /api/v1/discover
Request:
{
  "concept": "熵",
  "disciplines": ["数学", "物理", "信息论", "机器学习"],
  "depth": 2  # 挖掘深度
}

Response:
{
  "status": "success",
  "data": {
    "nodes": [...],
    "edges": [...],
    "metadata": {
      "total_concepts": 24,
      "verified_concepts": 18,
      "avg_credibility": 0.87
    }
  }
}
```

**接口2：概念验证**
```python
POST /api/v1/verify
Request:
{
  "concept_a": "熵",
  "concept_b": "信息增益",
  "claimed_relation": "信息增益基于熵的概念"
}

Response:
{
  "credibility": 0.92,
  "evidence": [
    "Wikipedia: Information theory",
    "Arxiv: 1234.5678"
  ],
  "warnings": []
}
```

---

### 成员B：架构与工程组（50%贡献）

#### 核心职责
**云原生架构 + 后端服务 + 前端可视化 + DevOps**

#### 详细任务清单

| 序号 | 模块 | 具体内容 | 贡献占比 | 预计工时 |
|------|------|---------|---------|---------|
| 1 | **云原生基础设施** | - 编写所有服务Dockerfile<br>- K8S配置（Deployment/Service/Ingress）<br>- Redis缓存配置<br>- MinIO对象存储配置<br>- Prometheus + Grafana监控 | 15% | 12h |
| 2 | **后端服务开发** | - RESTful API设计和实现<br>- Neo4j图数据库集成<br>- Milvus向量数据库集成<br>- WebSocket实时推送<br>- API Gateway配置 | 15% | 12h |
| 3 | **前端可视化系统** | - React项目搭建<br>- D3.js图谱渲染引擎<br>- 交互逻辑（节点展开、筛选、搜索）<br>- 响应式UI设计<br>- WebSocket客户端 | 15% | 12h |
| 4 | **工程质量保障** | - CI/CD Pipeline（GitHub Actions）<br>- 代码规范和Lint配置<br>- 单元测试和集成测试<br>- 完整文档（README、部署文档、架构文档）<br>- Docker Compose一键启动 | 5% | 4h |

**合计：50%  |  总工时：40小时**

#### 交付物清单

```
backend/                             # 后端服务
├── main.py                          # FastAPI主入口
├── config.py
├── requirements.txt
├── api/
│   ├── routes.py                    # API路由
│   ├── graph_service.py             # 图谱服务
│   └── websocket_handler.py         # WebSocket
├── database/
│   ├── neo4j_client.py              # Neo4j客户端
│   ├── milvus_client.py             # Milvus客户端
│   └── redis_client.py              # Redis客户端
└── models/
    ├── concept.py                   # 数据模型
    └── graph.py

frontend/                            # 前端应用
├── package.json
├── tsconfig.json
└── src/
    ├── App.tsx
    ├── components/
    │   ├── GraphVisualization.tsx   # D3图谱组件
    │   ├── SearchBar.tsx
    │   ├── NodeDetail.tsx
    │   └── FilterPanel.tsx
    ├── services/
    │   ├── api.ts                   # API调用
    │   └── websocket.ts
    └── types/
        └── graph.ts

infrastructure/                      # 云原生配置
├── docker/
│   ├── Dockerfile.backend
│   ├── Dockerfile.frontend
│   ├── Dockerfile.agents
│   └── docker-compose.yml
└── k8s/
    ├── deployments/
    │   ├── backend-deployment.yaml
    │   ├── frontend-deployment.yaml
    │   └── redis-deployment.yaml
    ├── services/
    │   ├── backend-service.yaml
    │   └── frontend-service.yaml
    └── ingress.yaml

docs/
├── architecture.md                  # 架构设计文档
├── deployment.md                    # 部署文档
└── api-reference.md                 # API文档

.github/
└── workflows/
    └── ci.yml                       # CI/CD配置

README.md                            # 项目说明文档
```

---

### 并行开发流程

```
第1-2天（独立搭建框架）
成员A                            成员B
├─ 搭建Agent框架                ├─ 搭建Docker环境
├─ 编写Prompt模板               ├─ 配置K8S基础设施
└─ 调试LLM API调用              └─ 搭建FastAPI项目骨架

第3天（接口定义）
双方会议：定义JSON接口规范
├─ 确定Request/Response格式
├─ 错误码定义
└─ Mock数据准备

第4-7天（并行开发）
成员A                            成员B
├─ 实现关联挖掘Agent            ├─ 开发后端API服务
├─ 实现知识校验Agent            ├─ 集成Neo4j数据库
├─ 实现图谱构建Agent            ├─ 开发前端React应用
└─ 单元测试                     └─ D3.js图谱组件

第8-10天（联调集成）
├─ 后端对接Agent接口
├─ 前端对接后端API
├─ 端到端测试
└─ Bug修复

第11-12天（文档和视频）
├─ 编写技术文档（分工协作）
├─ 录制演示视频
└─ 准备架构图

第13-14天（最终检查）
├─ Docker一键启动测试
├─ K8S部署测试
├─ 代码提交和整理
└─ 材料打包提交
```

---

## 五、接口契约与开发约定（第3天必须完成）⭐

> **重要性**：这是成员A和成员B能够并行开发的关键！必须在第3天开会明确以下所有约定。

### 5.1 API接口定义（JSON Schema）

#### 接口1：概念挖掘接口
**成员A提供 → 成员B调用**

```yaml
接口名称: discover_concepts
URL: POST /api/v1/agent/discover
超时时间: 60秒
幂等性: 是（相同输入返回相同结果）

Request Body:
{
  "concept": string,           # 必填，核心概念词，1-50字符
  "disciplines": string[],     # 可选，默认["数学","物理","化学","生物","计算机","社会学"]
  "depth": int,                # 可选，挖掘深度，默认2，范围[1-3]
  "max_concepts": int          # 可选，最大概念数，默认30，范围[10-100]
}

Response (成功 - 200):
{
  "status": "success",
  "request_id": string,        # 请求追踪ID
  "data": {
    "nodes": [
      {
        "id": string,          # 唯一标识，格式: "{概念名}_{学科拼音}"
        "label": string,       # 概念名称
        "discipline": string,  # 所属学科
        "definition": string,  # 简短定义，最多200字符
        "credibility": float   # 可信度，范围[0.0-1.0]
      }
    ],
    "edges": [
      {
        "source": string,      # 源节点id
        "target": string,      # 目标节点id
        "relation": string,    # 关系类型，枚举值见下方
        "weight": float,       # 关联强度，范围[0.0-1.0]
        "reasoning": string    # 关联原因，最多500字符
      }
    ],
    "metadata": {
      "total_nodes": int,
      "total_edges": int,
      "verified_nodes": int,   # 通过验证的节点数
      "avg_credibility": float,
      "processing_time": float # 处理耗时（秒）
    }
  }
}

Response (失败 - 4xx/5xx):
{
  "status": "error",
  "error_code": string,        # 错误码，见5.4节
  "message": string,           # 用户友好的错误消息
  "details": object            # 详细错误信息（可选）
}

关系类型枚举 (relation字段):
- "is_foundation_of": A是B的理论基础
- "similar_to": A和B在原理上相似
- "applied_in": A应用于B领域
- "generalizes": A是B的泛化
- "derived_from": A由B推导而来
```

#### 接口2：概念验证接口
**成员A提供 → 成员B调用（可选功能）**

```yaml
接口名称: verify_concept_relation
URL: POST /api/v1/agent/verify
超时时间: 30秒

Request Body:
{
  "concept_a": string,         # 必填，概念A
  "concept_b": string,         # 必填，概念B
  "claimed_relation": string,  # 必填，声称的关联描述
  "strength": float            # 可选，声称的关联强度
}

Response (200):
{
  "status": "success",
  "data": {
    "credibility_score": float,  # 可信度评分 [0.0-1.0]
    "is_valid": boolean,         # 是否有效（>= 0.5为true）
    "evidence": [
      {
        "source": string,        # 来源（Wikipedia/Arxiv等）
        "url": string,           # 证据链接
        "snippet": string        # 相关片段
      }
    ],
    "warnings": string[]         # 警告信息（如果有）
  }
}
```

#### 接口3：图谱增量扩展接口
**成员A提供 → 成员B调用（点击节点展开功能）**

```yaml
接口名称: expand_concept
URL: POST /api/v1/agent/expand
超时时间: 45秒

Request Body:
{
  "node_id": string,           # 必填，要扩展的节点ID
  "disciplines": string[],     # 可选，限定扩展的学科
  "max_new_nodes": int         # 可选，最多新增节点数，默认10
}

Response (200):
{
  "status": "success",
  "data": {
    "new_nodes": [...],        # 新增节点，格式同接口1
    "new_edges": [...],        # 新增边，格式同接口1
    "metadata": {
      "parent_node_id": string,
      "expansion_depth": int
    }
  }
}
```

---

### 5.2 数据模型定义（共享Schema）

#### 概念节点模型 (ConceptNode)
**文件位置**: `shared/schemas/concept_node.py`

```python
from pydantic import BaseModel, Field
from typing import Optional

class ConceptNode(BaseModel):
    """概念节点数据模型"""
    id: str = Field(..., description="唯一标识，格式: {概念名}_{学科拼音}")
    label: str = Field(..., min_length=1, max_length=100, description="概念名称")
    discipline: str = Field(..., description="所属学科")
    definition: str = Field(..., max_length=200, description="简短定义")
    credibility: float = Field(..., ge=0.0, le=1.0, description="可信度分数")
    metadata: Optional[dict] = Field(default=None, description="额外元数据")
    
    class Config:
        json_schema_extra = {
            "example": {
                "id": "entropy_xinxilun",
                "label": "熵",
                "discipline": "信息论",
                "definition": "信息的不确定性度量",
                "credibility": 0.95
            }
        }
```

#### 关系边模型 (ConceptEdge)
**文件位置**: `shared/schemas/concept_edge.py`

```python
class ConceptEdge(BaseModel):
    """概念关系边数据模型"""
    source: str = Field(..., description="源节点ID")
    target: str = Field(..., description="目标节点ID")
    relation: str = Field(..., description="关系类型")
    weight: float = Field(..., ge=0.0, le=1.0, description="关联强度")
    reasoning: str = Field(..., max_length=500, description="关联原因")
    
    class Config:
        json_schema_extra = {
            "example": {
                "source": "entropy_xinxilun",
                "target": "shannon_entropy_xinxilun",
                "relation": "is_foundation_of",
                "weight": 0.92,
                "reasoning": "香农熵是信息论中熵的具体定义"
            }
        }
```

#### 学科枚举
**文件位置**: `shared/constants.py`

```python
class Discipline:
    """学科常量定义"""
    MATH = "数学"
    PHYSICS = "物理"
    CHEMISTRY = "化学"
    BIOLOGY = "生物"
    COMPUTER = "计算机"
    SOCIOLOGY = "社会学"
    
    ALL = [MATH, PHYSICS, CHEMISTRY, BIOLOGY, COMPUTER, SOCIOLOGY]
    
    # 学科颜色映射（前端可视化用）
    COLORS = {
        MATH: "#FF6B6B",       # 红色
        PHYSICS: "#4ECDC4",    # 青色
        CHEMISTRY: "#95E1D3",  # 绿色
        BIOLOGY: "#F38181",    # 粉色
        COMPUTER: "#AA96DA",   # 紫色
        SOCIOLOGY: "#FCBAD3"   # 橙色
    }
```

---

### 5.3 环境变量约定

**文件位置**: `.env.example`

```bash
# ==================== 共享环境变量 ====================
PROJECT_NAME=ConceptGraph-AI
ENVIRONMENT=development  # development/staging/production

# ==================== 成员A负责配置 ====================
# LLM配置
OPENAI_API_KEY=sk-xxx
OPENAI_MODEL=gpt-4
OPENAI_TEMPERATURE=0.3
OPENAI_MAX_TOKENS=2000
OPENAI_TIMEOUT=60

# Agent配置
AGENT_MAX_RETRIES=3
AGENT_RETRY_DELAY=2
CREDIBILITY_THRESHOLD=0.5

# 数据抓取配置
WIKIPEDIA_API_URL=https://zh.wikipedia.org/api/rest_v1
ARXIV_API_URL=http://export.arxiv.org/api

# ==================== 成员B负责配置 ====================
# 后端服务
BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
API_PREFIX=/api/v1
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# 数据库配置
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=password
NEO4J_DATABASE=conceptgraph

MILVUS_HOST=localhost
MILVUS_PORT=19530
MILVUS_COLLECTION=concept_vectors

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_CACHE_TTL=3600  # 缓存过期时间（秒）

# MinIO配置
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=graph-snapshots

# 前端配置
REACT_APP_API_URL=http://localhost:8000/api/v1
REACT_APP_WS_URL=ws://localhost:8000/ws

# 监控配置
PROMETHEUS_PORT=9090
GRAFANA_PORT=3001
```

---

### 5.4 错误码规范

**文件位置**: `shared/error_codes.py`

```python
class ErrorCode:
    """统一错误码定义"""
    
    # 通用错误 (1000-1999)
    UNKNOWN_ERROR = "ERR_1000"
    INVALID_REQUEST = "ERR_1001"
    VALIDATION_ERROR = "ERR_1002"
    TIMEOUT = "ERR_1003"
    
    # Agent相关错误 (2000-2999)
    LLM_API_ERROR = "ERR_2001"         # LLM调用失败
    LLM_TIMEOUT = "ERR_2002"           # LLM超时
    PROMPT_ERROR = "ERR_2003"          # Prompt错误
    VERIFICATION_FAILED = "ERR_2004"   # 验证失败
    NO_CONCEPTS_FOUND = "ERR_2005"     # 未找到相关概念
    LOW_CREDIBILITY = "ERR_2006"       # 可信度过低
    
    # 数据库相关错误 (3000-3999)
    NEO4J_CONNECTION_ERROR = "ERR_3001"
    NEO4J_QUERY_ERROR = "ERR_3002"
    MILVUS_CONNECTION_ERROR = "ERR_3003"
    REDIS_ERROR = "ERR_3004"
    
    # 业务逻辑错误 (4000-4999)
    CONCEPT_NOT_FOUND = "ERR_4001"
    INVALID_DISCIPLINE = "ERR_4002"
    GRAPH_TOO_LARGE = "ERR_4003"       # 图谱节点过多
    DUPLICATE_CONCEPT = "ERR_4004"

# 错误消息映射
ERROR_MESSAGES = {
    ErrorCode.LLM_API_ERROR: "大模型调用失败，请稍后重试",
    ErrorCode.NO_CONCEPTS_FOUND: "未找到相关概念，请尝试其他关键词",
    ErrorCode.LOW_CREDIBILITY: "生成的关联可信度过低，已过滤",
    # ... 其他映射
}
```

---

### 5.5 WebSocket消息格式

**用途**: 实时推送Agent处理进度到前端

```typescript
// 消息类型枚举
enum WSMessageType {
  PROGRESS = "progress",      // 进度更新
  COMPLETE = "complete",      // 处理完成
  ERROR = "error",            // 错误
  NODE_ADDED = "node_added",  // 新增节点
  EDGE_ADDED = "edge_added"   // 新增边
}

// 进度消息
interface ProgressMessage {
  type: "progress";
  data: {
    request_id: string;
    stage: string;           // "discovering" | "verifying" | "building"
    progress: number;        // 0-100
    message: string;
    current_discipline?: string;
  }
}

// 完成消息
interface CompleteMessage {
  type: "complete";
  data: {
    request_id: string;
    total_nodes: number;
    total_edges: number;
    processing_time: number;
  }
}

// 实时节点添加
interface NodeAddedMessage {
  type: "node_added";
  data: ConceptNode;  // 使用共享数据模型
}
```

**WebSocket连接URL**: `ws://localhost:8000/ws/{request_id}`

---

### 5.6 目录结构约定

```
conceptgraph-ai/
├── shared/                          # 共享代码（双方都会用到）
│   ├── __init__.py
│   ├── schemas/                     # 共享数据模型
│   │   ├── __init__.py
│   │   ├── concept_node.py
│   │   ├── concept_edge.py
│   │   └── api_response.py
│   ├── constants.py                 # 常量定义
│   ├── error_codes.py               # 错误码
│   └── utils.py                     # 共享工具函数
│
├── agents/                          # 成员A负责
│   └── ...
│
├── backend/                         # 成员B负责
│   └── ...
│
├── frontend/                        # 成员B负责
│   └── ...
│
├── .env.example                     # 环境变量模板
├── docker-compose.yml               # 本地开发环境
└── README.md
```

**重要约定**:
- `shared/` 目录代码双方都可以修改，但需要通知对方
- 修改共享Schema必须向后兼容或提前沟通

---

### 5.7 Git工作流约定

```bash
# 分支策略
main              # 主分支，保护分支，仅通过PR合并
├── dev-agent     # 成员A开发分支
└── dev-infra     # 成员B开发分支

# 提交规范 (Conventional Commits)
feat: 新功能
fix: Bug修复
docs: 文档更新
style: 代码格式（不影响逻辑）
refactor: 重构
test: 测试相关
chore: 构建/工具配置

# 示例
git commit -m "feat(agent): 实现关联挖掘Agent"
git commit -m "fix(api): 修复超时错误处理"
```

**PR规范**:
- 标题: `[成员A/B] 功能简述`
- 描述: 改动内容、测试情况
- 至少由对方Review后才能合并

---

### 5.8 代码规范约定

#### Python代码（成员A后端部分 + 成员B后端部分）
```bash
# 格式化工具
black==24.1.0
isort==5.13.2

# 检查工具
flake8==7.0.0
mypy==1.8.0

# 配置文件: pyproject.toml
[tool.black]
line-length = 100
target-version = ['py39']

[tool.isort]
profile = "black"
```

#### TypeScript代码（成员B前端）
```json
// .eslintrc.json
{
  "extends": [
    "eslint:recommended",
    "plugin:react/recommended",
    "plugin:@typescript-eslint/recommended"
  ],
  "rules": {
    "semi": ["error", "always"],
    "quotes": ["error", "single"]
  }
}

// .prettierrc
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2
}
```

---

### 5.9 测试约定

#### Mock数据（第3天提供）
**文件位置**: `tests/mock_data.py`

```python
# 成员A提供给成员B的Mock响应
MOCK_DISCOVER_RESPONSE = {
    "status": "success",
    "request_id": "req_123456",
    "data": {
        "nodes": [
            {
                "id": "entropy_xinxilun",
                "label": "熵",
                "discipline": "信息论",
                "definition": "信息的不确定性度量",
                "credibility": 0.95
            },
            {
                "id": "shannon_entropy_xinxilun",
                "label": "香农熵",
                "discipline": "信息论",
                "definition": "信息论中熵的具体数学定义",
                "credibility": 0.92
            }
        ],
        "edges": [
            {
                "source": "entropy_xinxilun",
                "target": "shannon_entropy_xinxilun",
                "relation": "is_foundation_of",
                "weight": 0.92,
                "reasoning": "香农熵是信息论中熵的具体定义"
            }
        ],
        "metadata": {
            "total_nodes": 2,
            "total_edges": 1,
            "verified_nodes": 2,
            "avg_credibility": 0.935,
            "processing_time": 12.5
        }
    }
}
```

#### 测试端口约定
```
后端API: localhost:8000
前端Dev: localhost:3000
Neo4j: localhost:7687
Redis: localhost:6379
Milvus: localhost:19530
Prometheus: localhost:9090
Grafana: localhost:3001
```

---

### 5.10 会议检查清单（第3天必须完成）

```markdown
# 接口定义会议 Checklist

## 必须达成共识的内容
- [ ] API接口URL、方法、超时时间
- [ ] Request/Response JSON格式
- [ ] 数据模型Schema（ConceptNode, ConceptEdge）
- [ ] 关系类型枚举值
- [ ] 错误码定义
- [ ] 环境变量命名
- [ ] WebSocket消息格式
- [ ] 学科列表和颜色映射
- [ ] 可信度阈值（0.5）
- [ ] Mock数据准备

## 文档输出
- [ ] 创建 `shared/schemas/` 目录
- [ ] 创建 `.env.example` 文件
- [ ] 创建 `docs/api-contract.md` 接口契约文档
- [ ] 提交到Git，双方同步

## 开发约定
- [ ] 代码格式化工具（Black, Prettier）
- [ ] Git分支策略
- [ ] PR Review流程
- [ ] 每日同步时间（建议晚上10点）
```

---

## 六、关键Prompt模板示例

### 6.1 关联挖掘Prompt（带CoT推理）

```python
DISCOVERY_PROMPT = """
你是一个跨学科知识专家。请使用Chain-of-Thought推理，系统性地分析概念关联。

【步骤1：概念本质分析】
核心概念：{concept}
请回答：
1. 这个概念的核心定义是什么？
2. 它的数学/物理本质是什么？
3. 它解决了什么根本问题？

【步骤2：跨学科映射】
在以下学科中寻找相关概念：
{disciplines}

对于每个学科，请思考：
- 该学科中是否有类似的概念或原理？
- 底层机制是否相通？（如：优化、不确定性、信息传递、能量守恒等）
- 是否存在历史上的类比或启发关系？

【步骤3：关联强度量化】
根据以下标准评分（0-1）：
- 0.8-1.0：底层数学/物理原理完全相同
- 0.5-0.8：存在明确的类比关系或理论桥梁
- 0.2-0.5：概念间接相关，需要多步推理
- 0.0-0.2：几乎无关或牵强附会

【输出格式】（严格JSON）
{{
  "discipline": "学科名称",
  "related_concepts": ["概念1", "概念2"],
  "reasoning": "详细的推理过程（为什么这些概念相关）",
  "common_principle": "共同的底层原理",
  "strength": 0.85
}}

【重要提示】
- 必须在每个学科至少找出1个相关概念
- 避免表面的文字联系，要找深层原理
- 如果某个学科确实没有关联，strength设为0并说明原因

现在开始推理：
"""
```

### 5.2 知识校验Prompt

```python
VERIFICATION_PROMPT = """
你是一个严谨的知识验证专家。请验证以下概念关联的准确性。

【待验证的关联】
原始概念：{concept_a}
关联概念：{concept_b}
声称的关联：{claimed_relation}
关联强度：{strength}

【验证步骤】
1. 定义核查
   - 查阅权威来源（Wikipedia、学术教材）确认两个概念的标准定义
   - 检查定义中是否提到彼此或共同原理

2. 文献支持
   - 搜索是否有学术论文明确提到这种关联
   - 统计支持文献的数量和权威性

3. 逻辑一致性
   - 判断该关联在逻辑上是否成立
   - 是否存在反例或矛盾

【可信度评分标准】
- 0.9-1.0：学术界公认，有教材级支持
- 0.7-0.9：有多篇高质量论文支持
- 0.5-0.7：有一定依据但不充分
- 0.3-0.5：逻辑上成立但缺乏文献支持
- 0.0-0.3：可能错误或过度类比

【输出格式】（严格JSON）
{{
  "credibility_score": 0.87,
  "evidence": [
    "Wikipedia: [具体段落引用]",
    "学术论文: [标题和DOI]"
  ],
  "logical_reasoning": "逻辑分析",
  "warning": null  // 如有问题则填写警告信息
}}

【重要原则】
- 宁可严格，不可放松
- 低于0.5的关联建议标记为"待验证"
- 如果无法验证，明确说明原因

现在开始验证：
"""
```

### 5.3 图谱构建Prompt

```python
GRAPH_BUILDER_PROMPT = """
你是一个图数据结构专家。请将验证后的概念关联转换为标准的图数据格式。

【输入数据】
已验证的概念列表：{verified_concepts}

【任务要求】
1. 提取节点信息：
   - id：唯一标识符（使用概念名_学科）
   - label：概念名称
   - discipline：所属学科
   - definition：简短定义（1句话）
   - credibility：可信度分数

2. 提取边信息：
   - source：源节点id
   - target：目标节点id
   - relation：关系类型（is_foundation_of, similar_to, applied_in等）
   - weight：关联强度（0-1）
   - reasoning：关联原因（简述）

3. 关系类型定义：
   - "is_foundation_of"：A是B的理论基础
   - "similar_to"：A和B在原理上相似
   - "applied_in"：A应用于B领域
   - "generalizes"：A是B的泛化

【输出格式】（严格JSON）
{{
  "nodes": [
    {{
      "id": "entropy_information_theory",
      "label": "熵",
      "discipline": "信息论",
      "definition": "信息的不确定性度量",
      "credibility": 0.95
    }}
  ],
  "edges": [
    {{
      "source": "entropy_information_theory",
      "target": "shannon_entropy",
      "relation": "is_foundation_of",
      "weight": 0.92,
      "reasoning": "香农熵是信息论中熵的具体定义"
    }}
  ],
  "metadata": {{
    "total_nodes": 18,
    "total_edges": 24,
    "avg_credibility": 0.87
  }}
}}

现在开始构建：
"""
```

---

## 七、容错和质量保障

### 7.1 大模型幻觉处理 ⭐ **重要加分项**

| 问题 | 解决方案 |
|------|---------|
| 生成虚假关联 | 知识校验Agent强制验证，多源交叉检查 |
| 低质量输出 | 可信度评分，低于0.5标记为"待验证" |
| API调用失败 | 指数退避重试（最多3次），失败后降级到规则库 |
| 输出格式错误 | JSON Schema严格验证，错误时要求重新生成 |

### 7.2 系统稳定性设计

```python
# 示例：LLM调用容错
async def call_llm_with_retry(prompt, max_retries=3):
    for attempt in range(max_retries):
        try:
            response = await openai.ChatCompletion.create(
                model="gpt-4",
                messages=[{"role": "user", "content": prompt}],
                timeout=30
            )
            # JSON Schema验证
            validate_response(response)
            return response
        except Exception as e:
            if attempt == max_retries - 1:
                # 降级策略：使用本地规则库
                return fallback_rule_based_search(concept)
            # 指数退避
            await asyncio.sleep(2 ** attempt)
```

### 7.3 K8S健康检查

```yaml
# backend-deployment.yaml
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /ready
    port: 8000
  initialDelaySeconds: 5
  periodSeconds: 5
```

---

## 八、交付物清单

### 8.1 代码仓库（GitHub）
- ✅ 完整源码（agents/ backend/ frontend/）
- ✅ Dockerfile（所有服务可容器化）
- ✅ docker-compose.yml（一键启动）
- ✅ K8S配置（infrastructure/k8s/）
- ✅ 依赖文件（requirements.txt, package.json）
- ✅ 环境配置（.env.example）

### 8.2 技术文档
- ✅ **架构设计文档**：
  - 系统架构图（draw.io导出PNG）
  - 数据流向图
  - 云服务调用逻辑
  - 技术选型说明
  
- ✅ **分工说明文档**：
  - 成员A/B具体负责模块
  - 贡献百分比（各50%）
  - Git提交统计截图
  - 任务清单表格
  
- ✅ **智能体策略文档**：
  - 3个Agent的设计思路
  - 完整Prompt模板
  - CoT推理链展示
  - 工具链说明

- ✅ **部署文档**：
  - Docker启动步骤
  - K8S部署命令
  - 环境变量说明
  - 常见问题FAQ

- ✅ **API文档**：
  - 接口列表
  - 请求/响应示例
  - 错误码说明

### 8.3 演示视频（3-5分钟）

**推荐脚本**：
```
【0:00-0:30】痛点场景
- 展示学习"神经网络"时的知识碎片化问题

【0:30-1:30】架构讲解 ⭐ 必须
- 屏幕录制架构图
- 说明数据流向：用户请求 → Agent处理 → Neo4j → D3.js渲染
- 云服务：Docker + K8S + Redis + Neo4j + Prometheus

【1:30-3:30】功能演示
1. 输入"熵"
2. 展示Agent推理日志（可视化）
3. 图谱动态生成
4. 点击节点展开子概念
5. 悬浮查看可信度和来源
6. 学科筛选功能

【3:30-4:30】技术亮点
- 知识校验层（展示可信度标记）
- CoT推理链（展示Prompt）
- Docker一键启动
- K8S监控界面

【4:30-5:00】总结
```

---

## 九、评分优化策略

### 9.1 技术架构（30分）

| 评分项 | 我们的方案 | 预期得分 |
|--------|----------|---------|
| 云原生组件 | Docker + K8S + Redis + MinIO + Prometheus | 10/10 |
| 稳定性设计 | 健康检查 + 重试机制 + 降级策略 | 10/10 |
| 扩展性设计 | 微服务架构 + K8S自动扩缩容 | 9/10 |

### 9.2 智能逻辑（30分）

| 评分项 | 我们的方案 | 预期得分 |
|--------|----------|---------|
| 工程架构 | 多Agent协作 + 编排器 | 9/10 |
| Prompt工程 | CoT推理 + 结构化输出 + JSON Schema | 10/10 |
| 异常处理 | 知识校验层 + 幻觉检测 + 容错机制 | 10/10 |

### 9.3 工程质量（20分）

| 评分项 | 我们的方案 | 预期得分 |
|--------|----------|---------|
| 代码规范 | Black + ESLint + 类型提示 | 5/5 |
| 文档完整性 | 5份完整文档 + 架构图 | 10/10 |
| 分工清晰度 | 任务清单 + Git统计 | 5/5 |

### 9.4 演示效果（20分）

| 评分项 | 我们的方案 | 预期得分 |
|--------|----------|---------|
| 讲解清晰度 | 脚本化演示 + 高清录制 | 5/5 |
| 痛点深度 | 真实场景 + 价值说明 | 5/5 |
| Demo流畅性 | 提前测试 + 无Bug | 9/10 |

**预期总分：92-95分**

---

## 十、风险管理

### 10.1 成员A风险

| 风险 | 概率 | 应对措施 |
|------|------|---------|
| LLM API不稳定 | 中 | 降级到规则库 + 本地模型备选 |
| 跨学科关联不合理 | 中 | 知识校验层强制验证 |
| 数据抓取失败 | 低 | 提供本地知识库 |

### 10.2 成员B风险

| 风险 | 概率 | 应对措施 |
|------|------|---------|
| Docker环境问题 | 低 | 详细部署文档 + 云端Demo |
| D3.js渲染卡顿 | 中 | 限制节点数 + 按需加载 |
| K8S配置复杂 | 低 | docker-compose简化方案 |

---

## 十一、快速开始（README示例）

```markdown
# ConceptGraph AI - 跨学科知识图谱智能体

## 快速启动

### 一键启动（推荐）
\`\`\`bash
git clone https://github.com/your-team/conceptgraph-ai.git
cd conceptgraph-ai
docker-compose up -d

# 访问应用
# 前端：http://localhost:3000
# API：http://localhost:8000/docs
\`\`\`

### 配置环境变量
\`\`\`bash
cp .env.example .env
# 编辑.env，填入OpenAI API Key
\`\`\`

## 使用示例
1. 输入概念："熵"
2. 查看跨学科知识图谱
3. 点击节点展开相关概念

## 技术栈
- 云原生：Docker + K8S + Redis + MinIO
- 智能体：LangChain + GPT-4
- 数据库：Neo4j + Milvus
- 前端：React + D3.js
```

---

**备注**：此方案已充分考虑评分标准和两人并行开发需求，确保技术架构、智能逻辑、工程质量、演示效果四个维度均达到优秀水平。祝你们顺利完成作业，冲击高分！🚀
